void setup() {
  loadCenters("datacenters2.csv");
}

void draw() {
}

void loadCenters(String _url) {
  Table t = loadTable(_url, "header");
  t.addColumn("NativeLand");
  for (int i = 0; i < t.getRowCount(); i++) {
    TableRow r = t.getRow(i);
    float lat = r.getFloat("Latitude");
    float lon = r.getFloat("Longitude");
    JSONArray polys = getNativeLand(lat, lon);
    if (polys.size() > 0) {
      String nn = polys.getJSONObject(0).getJSONObject("properties").getString("Name");
      r.setString("NativeLand", nn);
    } else {
      println(lat + "," + lon);
    }
    
  }
  saveTable(t, "datacenters_native.tsv");
}

JSONArray getNativeLand(float _lat, float _lon) {
  String url = "https://native-land.ca/api/index.php?maps=languages&position=" + _lat + "," + _lon;
  JSONArray a = loadJSONArray(url);
  return(a);
}

//https://native-land.ca/api/index.php?maps=languages&position=42.553080,-86.473389

/*

 [{"type":"Feature","properties":{"Name":"Powatomi","description":"https:\/\/native-land.ca\/maps\/languages\/powatomi\/","Slug":"powatomi","FrenchName":"Powatomi","color":"#B022CC","FrenchDescription":"https:\/\/native-land.ca\/maps\/languages\/powatomi\/"},"geometry":{"coordinates":[[[-84.6386719999999996844053384847939014434814453125,45.8134859999999974888851284049451351165771484375,0],[-85.8251949999999936835592961870133876800537109375,45.398449999999996862243278883397579193115234375,0],[-86.967772999999993999153957702219486236572265625,44.33956500000000033878677641041576862335205078125,0],[-86.967772999999993999153957702219486236572265625,43.24520299999999650708559784106910228729248046875,0],[-86.7480469999999996844053384847939014434814453125,42.4558880000000016252670320682227611541748046875,0],[-86.0449219999999996844053384847939014434814453125,42.01665200000000055524651543237268924713134765625,0],[-85.583495999999996683982317335903644561767578125,41.6400780000000025893314159475266933441162109375,0],[-84.8364260000000030004230211488902568817138671875,41.82045500000000259888111031614243984222412109375,0],[-83.32031299999999873762135393917560577392578125,42.6177909999999968704287311993539333343505859375,0],[-82.3095699999999936835592961870133876800537109375,42.90816000000000229874785873107612133026123046875,0],[-82.111816000000004578396328724920749664306640625,43.67581799999999958572516334243118762969970703125,0],[-82.2875980000000026848283596336841583251953125,44.887011999999998579369275830686092376708984375,0],[-83.2543950000000023692336981184780597686767578125,45.58328999999999808778738952241837978363037109375,0],[-84.177245999999996683982317335903644561767578125,45.78284800000000132058630697429180145263671875,0],[-84.4628909999999990532160154543817043304443359375,45.82879899999999651072357664816081523895263671875,0],[-84.6386719999999996844053384847939014434814453125,45.8134859999999974888851284049451351165771484375,0]]],"type":"Polygon"},"id":"ebbfd2f91c2221f1aa8421316781ddbc"}]
 
 */